<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LightTouch Preview</title>
  <style>
    :root { --bg:#0b0c0f; --panel:#11131a; --text:#e8eaed; --muted:#9aa0a6; --accent:#7bd8ff; }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    header{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:16px;margin:0;font-weight:600;letter-spacing:.2px}
    .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    button, a.button{cursor:pointer;background:var(--panel);color:var(--text);border:1px solid #22263a;border-radius:10px;padding:8px 10px;text-decoration:none}
    button:hover, a.button:hover{border-color:#374166}
    .row{display:flex;gap:12px;align-items:stretch}
    .col{flex:1 1 auto}
    .pane{background:var(--panel);border:1px solid #1b2032;border-radius:12px;overflow:hidden}
    .pane header{padding:10px 12px;border-bottom:1px solid #1b2032;margin:0}
    .pane header h2{margin:0;font-size:12px;text-transform:uppercase;letter-spacing:.12em;color:var(--muted)}
    #frame{width:100%;border:0;display:block}
    #src{width:100%;min-height:120px;background:#0d0f16;color:#e8eaed;border:0;padding:12px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
    .hidden{display:none}
    .tip{color:var(--muted);font-size:12px;margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 id="title">LightTouch Preview</h1>
      <div class="controls">
        <button id="toggleSource" title="Show/Hide source">View source</button>
        <button id="copyBtn" title="Copy HTML to clipboard">Copy HTML</button>
        <button id="downloadBtn" title="Download as .html">Download</button>
        <a id="openRaw" class="button" href="#" target="_blank" rel="noopener">Open raw</a>
      </div>
    </header>

    <div class="row">
      <div class="col">
        <div class="pane">
          <header><h2>Preview</h2></header>
          <iframe id="frame" sandbox="allow-forms allow-popups allow-same-origin"></iframe>
        </div>
      </div>
    </div>

    <div id="sourcePane" class="pane hidden" style="margin-top:12px;">
      <header><h2>Source</h2></header>
      <textarea id="src" spellcheck="false"></textarea>
      <div class="tip">Param options: <code>?html=</code> (URL-encoded), <code>&b64=1</code> for base64, <code>&src=</code> to fetch HTML from a URL. Optional <code>&title=</code>.</div>
    </div>
  </div>

  <script>
    const qs = new URLSearchParams(location.search);
    const byId = id => document.getElementById(id);
    const frame = byId('frame');
    const srcTA = byId('src');

    function decodeInput() {
      let html = qs.get('html');
      const b64 = qs.get('b64') === '1';
      const from = qs.get('src');

      const setTitle = () => {
        const t = qs.get('title');
        if (t) { byId('title').textContent = t; document.title = t + ' â€¢ LightTouch'; }
      };
      setTitle();

      if (from) return fetchSource(from);

      if (html) {
        try {
          if (b64) html = atob(html);
          else html = decodeURIComponent(html);
        } catch(e) {}
        return Promise.resolve(html);
      }

      const placeholder = `<!doctype html><html><head><meta charset="utf-8"><meta name=viewport content="width=device-width"><title>LightTouch placeholder</title><style>body{font:16px/1.5 system-ui;max-width:720px;margin:3rem auto;padding:0 1rem;color:#222}code{background:#f4f6f8;padding:.2em .35em;border-radius:6px}</style></head><body><h2>It works.</h2><p>Pass your HTML using <code>?html=</code> (URL-encoded) or <code>?src=</code> (URL to a .html file). Optional <code>&b64=1</code> for base64, and <code>&title=</code> for the page title.</p><p>Example:<br><code>?title=Email%20Preview&html=%3Ch1%3EHello%20world%3C%2Fh1%3E</code></p></body></html>`;
      return Promise.resolve(placeholder);
    }

    async function fetchSource(u) {
      try {
        const res = await fetch(u, { mode: 'cors' });
        return await res.text();
      } catch (e) {
        return `<!doctype html><meta charset=utf-8><style>body{font:16px system-ui;padding:2rem}</style><h2>Could not fetch <code>${u.replace(/</g,'&lt;')}</code></h2><p>${e.message}</p><p>Ensure the source allows CORS.</p>`;
      }
    }

    function render(html) {
      srcTA.value = html;
      frame.srcdoc = html;

      requestAnimationFrame(() => {
        try {
          const doc = frame.contentDocument;
          const adjust = () => frame.style.height = Math.max(300, doc.documentElement.scrollHeight, doc.body?.scrollHeight || 0) + 'px';
          doc.addEventListener('load', adjust, true);
          adjust();
        } catch (e) {
          frame.style.height = '600px';
        }
      });

      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      byId('openRaw').href = url;
    }

    byId('toggleSource').addEventListener('click', () => {
      byId('sourcePane').classList.toggle('hidden');
    });

    byId('copyBtn').addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(srcTA.value); toast('Copied'); } catch (e) { toast('Copy failed'); }
    });

    byId('downloadBtn').addEventListener('click', () => {
      const a = document.createElement('a');
      a.download = (qs.get('title') || 'preview') + '.html';
      a.href = byId('openRaw').href;
      a.click();
    });

    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.cssText = 'position:fixed;right:12px;bottom:12px;background:#1b2032;color:#e8eaed;padding:8px 10px;border:1px solid #22263a;border-radius:10px;opacity:.98;z-index:9999';
      document.body.appendChild(t); 
      setTimeout(()=>t.remove(),1200);
    }

    decodeInput().then(render);
  </script>
</body>
</html>
